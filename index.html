<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Festive Truth or Dare</title>
    <style>
        :root {
            --truth-color: #fdfbf7;
            --truth-text: #b8860b;
            --dare-color: #8b0000;
            --dare-text: #ffffff;
            --bg-christmas: #0f2c1f;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-christmas);
            overflow-x: hidden;
            color: white;
            user-select: none;
        }

        /* --- Animations --- */
        .snow-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 50vh; 
            pointer-events: none; z-index: 1;
            mask-image: linear-gradient(to bottom, rgba(0,0,0,1), rgba(0,0,0,0));
            -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1), rgba(0,0,0,0));
        }
        .snowflake {
            position: absolute; top: -10px; color: white; animation: fall linear infinite;
        }
        .deer-container {
            position: fixed; bottom: 15%; left: -100px; font-size: 3rem; z-index: 5;
            pointer-events: none; animation: runAcross 20s linear infinite;
        }
        .deer-icon { display: block; animation: bob 0.5s infinite alternate; }
        .xmas-tree {
            position: fixed; bottom: 10px; right: 10px; font-size: 4rem; z-index: 20;
            pointer-events: none; filter: drop-shadow(0 0 10px gold);
        }
        @keyframes runAcross {
            0% { left: -100px; transform: scaleX(1); } 
            40% { left: 110vw; transform: scaleX(1); }
            40.01% { transform: scaleX(-1); }
            50% { left: 110vw; transform: scaleX(-1); }
            90% { left: -100px; transform: scaleX(-1); }
            100% { left: -100px; transform: scaleX(1); }
        }
        @keyframes bob { from { transform: translateY(0); } to { transform: translateY(-5px); } }
        @keyframes fall { to { transform: translateY(60vh); } }
        .burst-flake {
            position: absolute; background: white; border-radius: 50%;
            pointer-events: none; z-index: 999; animation: burst 1s forwards;
        }
        @keyframes burst {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }

        /* --- Layout --- */
        .app-container {
            display: flex; flex-direction: column; min-height: 100vh; position: relative; z-index: 10;
        }
        .settings-panel {
            background: rgba(0, 0, 0, 0.85); padding: 15px; backdrop-filter: blur(8px);
            border-bottom: 2px solid #c0392b; text-align: center; max-height: 40vh; overflow-y: auto;
        }
        h1 { 
            margin: 0 0 10px 0; font-family: 'Georgia', serif; letter-spacing: 2px; font-size: 1.5rem; 
            cursor: pointer; transition: color 0.3s;
        }
        h1:hover { color: gold; text-shadow: 0 0 10px gold; }
        
        .control-group { margin-bottom: 12px; }
        .label-title { display: block; margin-bottom: 6px; font-weight: bold; font-size: 0.8rem; opacity: 0.8; text-transform: uppercase;}

        /* Styled Checkboxes */
        .checkbox-group { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
        .checkbox-group input[type="radio"] { display: none; }
        .checkbox-group label {
            background: rgba(255,255,255,0.1); padding: 5px 12px; border-radius: 20px;
            cursor: pointer; border: 1px solid rgba(255,255,255,0.3); transition: 0.2s; font-size: 0.8rem;
        }
        .checkbox-group input[type="radio"]:checked + label {
            background: #c0392b; border-color: #e74c3c; font-weight: bold; box-shadow: 0 0 8px #c0392b;
        }

        #extra-languages { display: none; margin-top: 10px; animation: fadeIn 0.3s; }
        .toggle-btn {
            background: none; border: 1px dashed rgba(255,255,255,0.4); color: #ddd;
            padding: 4px 10px; border-radius: 15px; cursor: pointer; font-size: 0.7rem; margin-top: 5px;
        }

        #personalize-container { display: none; margin-top: 15px; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 10px; }
        .input-row { display: flex; gap: 5px; justify-content: center; }
        #personalize-prompt { padding: 8px; border-radius: 5px; border: none; width: 70%; }
        #generate-btn { padding: 8px 15px; background: gold; border: none; border-radius: 5px; color: #8b0000; font-weight: bold; cursor: pointer; }
        #gen-status { font-size: 0.8rem; margin-top: 5px; color: #aaa; min-height: 1.2em; }

        /* --- Game Area --- */
        .game-area { flex-grow: 1; display: flex; flex-direction: column; }
        .card {
            flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 15px; text-align: center; cursor: pointer; position: relative; overflow: hidden; min-height: 250px;
        }
        .card:active { transform: scale(0.98); }
        .truth-section { background: var(--truth-color); color: var(--truth-text); border-bottom: 4px solid gold; }
        .dare-section { background: var(--dare-color); color: var(--dare-text); border-top: 4px solid gold; }
        .card-icon { font-size: 2rem; margin-bottom: 5px; }
        .card-title { font-size: 1.6rem; font-weight: 800; text-transform: uppercase; margin: 0; }
        .prompt-content { margin-top: 10px; display: flex; flex-direction: column; align-items: center; width: 100%; min-height: 120px; }
        .prompt-text { font-size: 1.3rem; font-weight: 600; margin-bottom: 10px; max-width: 90%; word-wrap: break-word; line-height: 1.4; }
        .dare-visual { font-size: 5rem; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); display: none; animation: popIn 0.5s; }
        .click-instruction { position: absolute; bottom: 10px; font-size: 0.7rem; opacity: 0.6; text-transform: uppercase; letter-spacing: 1px; animation: pulse 2s infinite; pointer-events: none;}
        
        .final-message { 
            color: #27ae60; font-weight: 900; font-family: 'Georgia', serif; font-size: 1.6rem; 
            text-shadow: 1px 1px 0px white; animation: popIn 0.8s;
        }

        @keyframes pulse { 0% { opacity: 0.4; } 50% { opacity: 0.8; } 100% { opacity: 0.4; } }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
        .fade-in { animation: fadeIn 0.5s forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="snow-container" id="snow-bg"></div>
    <div class="deer-container"><div class="deer-icon">ü¶å</div></div>
    <div class="xmas-tree">üéÑ</div>

    <div class="app-container">
        
        <div class="settings-panel">
            <h1 onclick="location.reload()" title="Click to Reset">üéÑ Truth or Dare üéÅ</h1>

            <div class="control-group">
                <span class="label-title">Language</span>
                <div class="checkbox-group">
                    <input type="radio" name="lang" id="en" value="en" checked onclick="setLang('en')">
                    <label for="en">üá∫üá∏ EN</label>
                    <input type="radio" name="lang" id="fr" value="fr" onclick="setLang('fr')">
                    <label for="fr">üá´üá∑ FR</label>
                    <input type="radio" name="lang" id="es" value="es" onclick="setLang('es')">
                    <label for="es">üá™üá∏ ES</label>
                    <input type="radio" name="lang" id="zh" value="zh" onclick="setLang('zh')">
                    <label for="zh">üá®üá≥ ZH</label>
                </div>
                <button class="toggle-btn" onclick="toggleExtraLangs()">+ More / Plus / Mehr</button>
                <div class="checkbox-group" id="extra-languages">
                    <input type="radio" name="lang" id="it" value="it" onclick="setLang('it')">
                    <label for="it">üáÆüáπ IT</label>
                    <input type="radio" name="lang" id="de" value="de" onclick="setLang('de')">
                    <label for="de">üá©üá™ DE</label>
                    <input type="radio" name="lang" id="ja" value="ja" onclick="setLang('ja')">
                    <label for="ja">üáØüáµ JA</label>
                    <input type="radio" name="lang" id="da" value="da" onclick="setLang('da')">
                    <label for="da">üá©üá∞ DA</label>
                </div>
            </div>

            <div class="control-group">
                <span class="label-title">Scenario</span>
                <div class="checkbox-group">
                    <input type="radio" name="scen" id="christmas" value="christmas" checked onclick="setScenario('christmas')">
                    <label for="christmas">üéÖ Xmas</label>
                    <input type="radio" name="scen" id="campus" value="campus" onclick="setScenario('campus')">
                    <label for="campus">üè´ Campus</label>
                    <input type="radio" name="scen" id="friends" value="friends" onclick="setScenario('friends')">
                    <label for="friends">üçª Friends</label>
                    <input type="radio" name="scen" id="family" value="family" onclick="setScenario('family')">
                    <label for="family">üè† Family</label>
                    <input type="radio" name="scen" id="personalize" value="personalize" onclick="setScenario('personalize')">
                    <label for="personalize">‚ú® Personalize</label>
                </div>
            </div>

            <div id="personalize-container">
                <div class="input-row">
                    <input type="text" id="personalize-prompt" placeholder="e.g. International students party...">
                    <button id="generate-btn" onclick="generatePersonalizedDeck()">Go!</button>
                </div>
                <div id="gen-status"></div>
            </div>
        </div>

        <div class="game-area">
            <div class="card truth-section" onclick="playTurn(this, 'truth')">
                <div class="card-icon">üòá</div>
                <h2 class="card-title">Truth</h2>
                <div class="prompt-content">
                    <div class="prompt-text" id="truth-text">Tap for Truth</div>
                </div>
                <div class="click-instruction">Click to switch to next question</div>
            </div>

            <div class="card dare-section" onclick="playTurn(this, 'dare')">
                <div class="card-icon">üòà</div>
                <h2 class="card-title">Dare</h2>
                <div class="prompt-content">
                    <div class="prompt-text" id="dare-text">Tap for Dare</div>
                    <div id="dare-visual" class="dare-visual"></div>
                </div>
                <div class="click-instruction">Click to switch to next question</div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA STORE ---
        // Populated English, French, Chinese, Spanish fully. 
        // Others map to English to ensure game doesn't break.
        const db = {
            en: {
                campus: { truth: ["Who is your campus crush?", "Lowest grade ever?", "Fallen asleep in class?", "Cheated on an exam?", "Stolen food from roommate?", "Weirdest professor?", "Skipped whole day?", "Lied for extension?", "Worst cafeteria meal?", "Who do you avoid?", "Wrong class walk-in?", "Embarrassing moment?", "Hooked up in dorm?", "Who studies least?", "Failed a class?"], dare: [{t:"Yell 'I love exams'.",i:"üì¢"}, {t:"Funny dance hallway.",i:"üíÉ"}, {t:"Text crush emoji.",i:"üëã"}, {t:"Ask stranger pencil.",i:"‚úèÔ∏è"}, {t:"Sit on floor.",i:"üßò"}, {t:"British accent.",i:"üá¨üáß"}, {t:"Selfie to prof.",i:"ü§≥"}, {t:"Book on head.",i:"üìö"}, {t:"Act like monkey.",i:"üêí"}, {t:"Draw on hand.",i:"‚úçÔ∏è"}, {t:"Imitate teacher.",i:"üë®‚Äçüè´"}, {t:"Walk backwards.",i:"üîô"}, {t:"Sing anthem.",i:"üé§"}, {t:"Show last photo.",i:"üì∑"}, {t:"Call mom: 'Failed'.",i:"üìû"}] },
                family: { truth: ["Favorite child?", "Secret from mom?", "Worst gift?", "Blamed sibling?", "Lied about location?", "Snuck out?", "Annoying relative?", "Lie to dad?", "Read diary?", "Grandma's cooking?", "Worst trouble?", "Faked sick?", "Dislike cousin?", "Hate tradition?", "Stolen money?"], dare: [{t:"Hug sibling.",i:"ü´Ç"}, {t:"Sing Xmas song.",i:"üé∂"}, {t:"Show last photo.",i:"üì±"}, {t:"Do dishes.",i:"üçΩÔ∏è"}, {t:"Massage mom.",i:"üíÜ"}, {t:"Act like baby.",i:"üë∂"}, {t:"Dad picks pic.",i:"üñºÔ∏è"}, {t:"Dance sibling.",i:"üíÉ"}, {t:"Eat raw garlic.",i:"üßÑ"}, {t:"Say I love you.",i:"‚ù§Ô∏è"}, {t:"Crab walk.",i:"ü¶Ä"}, {t:"Funny face.",i:"ü§™"}, {t:"Smell socks.",i:"üß¶"}, {t:"Get tickled.",i:"ü§£"}, {t:"Whisper only.",i:"ü§´"}] },
                friends: { truth: ["Trust least?", "Regret?", "Lied to cancel?", "Stalked ex?", "Best dressed?", "Kissed friend's ex?", "Embarrassing habit?", "Funniest here?", "Peed in pool?", "Grossest thing?", "Worst driver?", "Stolen something?", "Date who here?", "Biggest fear?", "Last cried?"], dare: [{t:"Swap shirts left.",i:"üëï"}, {t:"Group DM Insta.",i:"üí¨"}, {t:"10 pushups.",i:"üí™"}, {t:"Accent 2 rounds.",i:"üó£Ô∏è"}, {t:"Style hair.",i:"üíá"}, {t:"Hot sauce spoon.",i:"üå∂Ô∏è"}, {t:"Funny selfie.",i:"üì∏"}, {t:"Bark like dog.",i:"üê∂"}, {t:"Drink mystery mix.",i:"ü•§"}, {t:"Spin 10 times.",i:"üòµ"}, {t:"Draw forehead.",i:"üñçÔ∏è"}, {t:"Broom dance.",i:"üßπ"}, {t:"Imitate someone.",i:"ü§°"}, {t:"Ice cube hold.",i:"üßä"}, {t:"Read last text.",i:"üì±"}] },
                christmas: { truth: ["Worst gift given?", "Re-gifted?", "Like fruitcake?", "Peaked at gifts?", "Worst cook?", "Believe in Santa?", "Knocked tree?", "Worst Xmas movie?", "Forgot gift?", "Who drinks too much?", "Best memory?", "Mistletoe kiss?", "Want for Xmas?", "Like eggnog?", "Broken ornament?"], dare: [{t:"Reindeer act.",i:"ü¶å"}, {t:"Eat cinnamon.",i:"ü•Ñ"}, {t:"Wear bow.",i:"üéÄ"}, {t:"Ho Ho Ho.",i:"üéÖ"}, {t:"Tinsel wrap.",i:"üéÑ"}, {t:"Opera Jingle Bells.",i:"üé§"}, {t:"Sit on lap.",i:"ü™ë"}, {t:"Elf act.",i:"üßù"}, {t:"Santa belly.",i:"ü§∞"}, {t:"Paper snowflake.",i:"‚ùÑÔ∏è"}, {t:"Kiss neighbor.",i:"üíã"}, {t:"Cookie no hands.",i:"üç™"}, {t:"Freeze snowman.",i:"‚õÑ"}, {t:"Melting candle.",i:"üïØÔ∏è"}, {t:"Unwrap air.",i:"üéÅ"}] }
            },
            fr: {
                campus: { truth: ["Crush sur le campus ?", "Pire note ?", "Dormi en classe ?", "Trich√© exam ?", "Vol√© nourriture ?", "Prof bizarre ?", "S√©ch√© un jour ?", "Menti d√©lai ?", "Pire repas ?", "Qui √©vites-tu ?", "Tromp√© salle ?", "Moment g√™nant ?", "Dormi dortoir ?", "Qui bosse pas ?", "Rat√© cours ?"], dare: [{t:"Crie 'J'aime exams'.",i:"üì¢"}, {t:"Danse couloir.",i:"üíÉ"}, {t:"SMS crush emoji.",i:"üëã"}, {t:"Demande crayon.",i:"‚úèÔ∏è"}, {t:"Assieds-toi sol.",i:"üßò"}, {t:"Accent anglais.",i:"üá¨üáß"}, {t:"Selfie prof.",i:"ü§≥"}, {t:"Livre sur t√™te.",i:"üìö"}, {t:"Fais le singe.",i:"üêí"}, {t:"Dessine main.",i:"‚úçÔ∏è"}, {t:"Imite prof.",i:"üë®‚Äçüè´"}, {t:"Marche reculons.",i:"üîô"}, {t:"Chante hymne.",i:"üé§"}, {t:"Montre photo.",i:"üì∑"}, {t:"Appelle maman.",i:"üìû"}] },
                family: { truth: ["Enfant pr√©f√©r√© ?", "Secret maman ?", "Pire cadeau ?", "Accus√© fr√®re ?", "Menti lieu ?", "Mur√© ?", "Parent chiant ?", "Menti papa ?", "Lu journal ?", "Cuisine mamie ?", "Pire b√™tise ?", "Faux malade ?", "Cousin nul ?", "Tradition nulle ?", "Vol√© argent ?"], dare: [{t:"C√¢lin fr√®re.",i:"ü´Ç"}, {t:"Chante No√´l.",i:"üé∂"}, {t:"Montre photo.",i:"üì±"}, {t:"Fais vaisselle.",i:"üçΩÔ∏è"}, {t:"Massage maman.",i:"üíÜ"}, {t:"Fais b√©b√©.",i:"üë∂"}, {t:"Papa choisit photo.",i:"üñºÔ∏è"}, {t:"Danse famille.",i:"üíÉ"}, {t:"Mange ail.",i:"üßÑ"}, {t:"Dis je t'aime.",i:"‚ù§Ô∏è"}, {t:"Marche crabe.",i:"ü¶Ä"}, {t:"Grimace.",i:"ü§™"}, {t:"Sent chaussette.",i:"üß¶"}, {t:"Guili-guili.",i:"ü§£"}, {t:"Chuchote.",i:"ü§´"}] },
                friends: { truth: ["Confiance ?", "Regret ?", "Menti plan ?", "Stalk√© ex ?", "Mieux habill√© ?", "Embrass√© ex ?", "Habitude ?", "Le plus dr√¥le ?", "Pipi piscine ?", "D√©go√ªtant ?", "Pire chauffeur ?", "Vol√© ?", "Date qui ?", "Peur ?", "Pleur√© ?"], dare: [{t:"√âchange t-shirt.",i:"üëï"}, {t:"DM groupe.",i:"üí¨"}, {t:"10 pompes.",i:"üí™"}, {t:"Accent.",i:"üó£Ô∏è"}, {t:"Coiffure.",i:"üíá"}, {t:"Mange piment.",i:"üå∂Ô∏è"}, {t:"Selfie dr√¥le.",i:"üì∏"}, {t:"Abbaie.",i:"üê∂"}, {t:"Bois myst√®re.",i:"ü•§"}, {t:"Tourne 10x.",i:"üòµ"}, {t:"Dessin front.",i:"üñçÔ∏è"}, {t:"Danse balais.",i:"üßπ"}, {t:"Imite ami.",i:"ü§°"}, {t:"Gla√ßon main.",i:"üßä"}, {t:"Lis SMS.",i:"üì±"}] },
                christmas: { truth: ["Pire cadeau ?", "Recycl√© ?", "Aimes fruitcake ?", "Vu cadeaux ?", "Pire cuistot ?", "P√®re No√´l ?", "Renvers√© sapin ?", "Pire film ?", "Oubli√© cadeau ?", "Boit trop ?", "Souvenir ?", "Gui ?", "Veux quoi ?", "Lait poule ?", "Cass√© boule ?"], dare: [{t:"Fais renne.",i:"ü¶å"}, {t:"Mange cannelle.",i:"ü•Ñ"}, {t:"N≈ìud t√™te.",i:"üéÄ"}, {t:"Ho Ho Ho.",i:"üéÖ"}, {t:"Guirlande.",i:"üéÑ"}, {t:"Chante op√©ra.",i:"üé§"}, {t:"Assieds genoux.",i:"ü™ë"}, {t:"Fais l'elfe.",i:"üßù"}, {t:"Ventre No√´l.",i:"ü§∞"}, {t:"Flocon papier.",i:"‚ùÑÔ∏è"}, {t:"Bisou voisin.",i:"üíã"}, {t:"Biscuit sans main.",i:"üç™"}, {t:"Statue neige.",i:"‚õÑ"}, {t:"Bougie.",i:"üïØÔ∏è"}, {t:"Ouvre air.",i:"üéÅ"}] }
            },
            zh: {
                campus: { truth: ["ÊöóÊÅãË∞ÅÔºü", "ÊúÄ‰ΩéÂàÜÔºü", "Áù°ËøáÂ§¥Ôºü", "‰ΩúÂºäÔºü", "ÂÅ∑ÂêÉÔºü", "ÊÄ™ÊïôÊéàÔºü", "ÁøòËØæÔºü", "ÊííË∞éÔºü", "ÈöæÂêÉÈ£üÂ†ÇÔºü", "Ë∫≤Ë∞ÅÔºü", "Ëµ∞ÈîôË∑ØÔºü", "Â∞¥Â∞¨Ôºü", "ÂÆøËàçËøáÂ§úÔºü", "‰∏çÂ≠¶‰π†Ôºü", "ÊåÇÁßëÔºü"], dare: [{t:"ÂñäÁà±ËÄÉËØï„ÄÇ",i:"üì¢"}, {t:"Ë∑≥Ëàû„ÄÇ",i:"üíÉ"}, {t:"ÂèëË°®ÊÉÖ„ÄÇ",i:"üëã"}, {t:"ÂÄüÁ¨î„ÄÇ",i:"‚úèÔ∏è"}, {t:"ÂùêÂú∞‰∏ä„ÄÇ",i:"üßò"}, {t:"Âè£Èü≥„ÄÇ",i:"üá¨üáß"}, {t:"Ëá™ÊãçÊïôÊéà„ÄÇ",i:"ü§≥"}, {t:"È°∂‰π¶„ÄÇ",i:"üìö"}, {t:"Â≠¶Áå¥Â≠ê„ÄÇ",i:"üêí"}, {t:"ÁîªÊâã„ÄÇ",i:"‚úçÔ∏è"}, {t:"Ê®°‰ªøËÄÅÂ∏à„ÄÇ",i:"üë®‚Äçüè´"}, {t:"ÂÄíËµ∞„ÄÇ",i:"üîô"}, {t:"Âî±ÂõΩÊ≠å„ÄÇ",i:"üé§"}, {t:"ÁúãÁÖßÁâá„ÄÇ",i:"üì∑"}, {t:"ÊâìÁîµËØùÂì≠„ÄÇ",i:"üìû"}] },
                family: { truth: ["ÊúÄÁà±Â≠©Â≠êÔºü", "ÁßòÂØÜÔºü", "ÁÉÇÁ§ºÁâ©Ôºü", "Â´ÅÁ•∏Ôºü", "È™óÂéªÂêëÔºü", "Ê∫úËµ∞Ôºü", "ÁÉ¶‰∫≤ÊàöÔºü", "È™óÁà∏Áà∏Ôºü", "ÁúãÊó•ËÆ∞Ôºü", "Â•∂Â•∂ËèúÔºü", "Â§ßÈ∫ªÁÉ¶Ôºü", "Ë£ÖÁóÖÔºü", "ËÆ®ÂéåË∞ÅÔºü", "ÁÉÇ‰º†ÁªüÔºü", "ÂÅ∑Èí±Ôºü"], dare: [{t:"Êã•Êä±„ÄÇ",i:"ü´Ç"}, {t:"Âî±Âú£ËØûÊ≠å„ÄÇ",i:"üé∂"}, {t:"ÁúãÁÖßÁâá„ÄÇ",i:"üì±"}, {t:"Ê¥óÁ¢ó„ÄÇ",i:"üçΩÔ∏è"}, {t:"ÊåâÊë©„ÄÇ",i:"üíÜ"}, {t:"Â≠¶Â©¥ÂÑø„ÄÇ",i:"üë∂"}, {t:"Áà∏ÈÄâÂ§¥ÂÉè„ÄÇ",i:"üñºÔ∏è"}, {t:"Ë∑≥Ëàû„ÄÇ",i:"üíÉ"}, {t:"ÂêÉËíú„ÄÇ",i:"üßÑ"}, {t:"ËØ¥Áà±‰Ω†„ÄÇ",i:"‚ù§Ô∏è"}, {t:"ËûÉËüπÊ≠•„ÄÇ",i:"ü¶Ä"}, {t:"È¨ºËÑ∏„ÄÇ",i:"ü§™"}, {t:"ÈóªË¢úÂ≠ê„ÄÇ",i:"üß¶"}, {t:"Êå†Áóí„ÄÇ",i:"ü§£"}, {t:"ËÄ≥ËØ≠„ÄÇ",i:"ü§´"}] },
                friends: { truth: ["‰∏ç‰ø°Ë∞ÅÔºü", "ÂêéÊÇîÔºü", "È∏ΩÂ≠êÔºü", "ËßÜÂ•∏Ôºü", "Êó∂Â∞öÔºü", "‰∫≤Ââç‰ªªÔºü", "‰π†ÊÉØÔºü", "ÊêûÁ¨ëÔºü", "Â∞øÂ∫äÔºü", "ÊÅ∂ÂøÉÔºü", "ÁÉÇÂè∏Êú∫Ôºü", "ÂÅ∑‰∏úË•øÔºü", "Á∫¶Ë∞ÅÔºü", "ÊÅêÊÉßÔºü", "Âì≠Ôºü"], dare: [{t:"Êç¢Ë°£„ÄÇ",i:"üëï"}, {t:"Áæ§Âèë„ÄÇ",i:"üí¨"}, {t:"‰øØÂçßÊíë„ÄÇ",i:"üí™"}, {t:"Âè£Èü≥„ÄÇ",i:"üó£Ô∏è"}, {t:"ÂÅöÂèëÂûã„ÄÇ",i:"üíá"}, {t:"ÂêÉËæ£„ÄÇ",i:"üå∂Ô∏è"}, {t:"‰∏ëÁÖß„ÄÇ",i:"üì∏"}, {t:"ÁãóÂè´„ÄÇ",i:"üê∂"}, {t:"ÂñùÊ∑∑Âêà„ÄÇ",i:"ü•§"}, {t:"ËΩ¨Âúà„ÄÇ",i:"üòµ"}, {t:"ÁîªÂ§¥„ÄÇ",i:"üñçÔ∏è"}, {t:"Êâ´ÊääËàû„ÄÇ",i:"üßπ"}, {t:"Ê®°‰ªø„ÄÇ",i:"ü§°"}, {t:"ÊãøÂÜ∞„ÄÇ",i:"üßä"}, {t:"ËØªÁü≠‰ø°„ÄÇ",i:"üì±"}] },
                christmas: { truth: ["ÁÉÇÁ§ºÁâ©Ôºü", "ËΩ¨ÈÄÅÔºü", "Ê∞¥ÊûúËõãÁ≥ïÔºü", "ÂÅ∑ÁúãÔºü", "ÁÉÇÂé®Â∏àÔºü", "Âú£ËØûËÄÅ‰∫∫Ôºü", "ÂÄíÊ†ëÔºü", "ÁÉÇÁîµÂΩ±Ôºü", "ÂøòÁ§ºÁâ©Ôºü", "ÂñùÂ§öÔºü", "ÂõûÂøÜÔºü", "Êß≤ÂØÑÁîüÔºü", "ÊÉ≥Ë¶ÅÂï•Ôºü", "ËõãÈÖíÔºü", "Á¢éË£ÖÈ•∞Ôºü"], dare: [{t:"È©ØÈπø„ÄÇ",i:"ü¶å"}, {t:"ÂêÉÊ°ÇÁöÆ„ÄÇ",i:"ü•Ñ"}, {t:"Êà¥Áªì„ÄÇ",i:"üéÄ"}, {t:"HoHoHo„ÄÇ",i:"üéÖ"}, {t:"ÂΩ©Â∏¶„ÄÇ",i:"üéÑ"}, {t:"Ê≠åÂâß„ÄÇ",i:"üé§"}, {t:"ÂùêËÖø„ÄÇ",i:"ü™ë"}, {t:"Á≤æÁÅµ„ÄÇ",i:"üßù"}, {t:"Â§ßËÇö„ÄÇ",i:"ü§∞"}, {t:"Ââ™Á∫∏„ÄÇ",i:"‚ùÑÔ∏è"}, {t:"‰∫≤‰∫∫„ÄÇ",i:"üíã"}, {t:"ÂêÉÈ•ºÂπ≤„ÄÇ",i:"üç™"}, {t:"Èõ™‰∫∫„ÄÇ",i:"‚õÑ"}, {t:"Ëú°ÁÉõ„ÄÇ",i:"üïØÔ∏è"}, {t:"ÊãÜÁ§ºÁâ©„ÄÇ",i:"üéÅ"}] }
            },
            es: {
                campus: { truth: ["¬øAmor?", "¬øPeor nota?", "¬øDormido?", "¬øCopiado?", "¬øRobado comida?", "¬øProfe raro?", "¬øFaltado?", "¬øMentido?", "¬øComida mala?", "¬øEvitas?", "¬øClase mal?", "¬øVerg√ºenza?", "¬øDormitorio?", "¬øVago?", "¬øSuspendido?"], dare: [{t:"Grita amor.",i:"üì¢"}, {t:"Baila.",i:"üíÉ"}, {t:"Emoji crush.",i:"üëã"}, {t:"Pide l√°piz.",i:"‚úèÔ∏è"}, {t:"Suelo.",i:"üßò"}, {t:"Acento.",i:"üá¨üáß"}, {t:"Selfie profe.",i:"ü§≥"}, {t:"Libro cabeza.",i:"üìö"}, {t:"Mono.",i:"üêí"}, {t:"Dibuja mano.",i:"‚úçÔ∏è"}, {t:"Imita profe.",i:"üë®‚Äçüè´"}, {t:"Camina atr√°s.",i:"üîô"}, {t:"Himno.",i:"üé§"}, {t:"Foto.",i:"üì∑"}, {t:"Llama mam√°.",i:"üìû"}] },
                family: { truth: ["¬øHijo fav?", "¬øSecreto?", "¬øRegalo mal?", "¬øCulpado?", "¬øMentido?", "¬øEscapado?", "¬øPariente?", "¬øMentira pap√°?", "¬øDiario?", "¬øCocina?", "¬øL√≠o?", "¬øFalso enfermo?", "¬øPrimo?", "¬øTradici√≥n?", "¬øDinero?"], dare: [{t:"Abrazo.",i:"ü´Ç"}, {t:"Canta.",i:"üé∂"}, {t:"Foto.",i:"üì±"}, {t:"Platos.",i:"üçΩÔ∏è"}, {t:"Masaje.",i:"üíÜ"}, {t:"Beb√©.",i:"üë∂"}, {t:"Perfil.",i:"üñºÔ∏è"}, {t:"Baila.",i:"üíÉ"}, {t:"Ajo.",i:"üßÑ"}, {t:"Te quiero.",i:"‚ù§Ô∏è"}, {t:"Cangrejo.",i:"ü¶Ä"}, {t:"Mueca.",i:"ü§™"}, {t:"Calcet√≠n.",i:"üß¶"}, {t:"Cosquillas.",i:"ü§£"}, {t:"Susurro.",i:"ü§´"}] },
                friends: { truth: ["¬øConfianza?", "¬øArrepentimiento?", "¬øPlan?", "¬øStalk?", "¬øVestido?", "¬øEx amigo?", "¬øH√°bito?", "¬øGracioso?", "¬øPiscina?", "¬øAsco?", "¬øConductor?", "¬øRobado?", "¬øCita?", "¬øMiedo?", "¬øLlanto?"], dare: [{t:"Camisa.",i:"üëï"}, {t:"DM.",i:"üí¨"}, {t:"Flexiones.",i:"üí™"}, {t:"Acento.",i:"üó£Ô∏è"}, {t:"Pelo.",i:"üíá"}, {t:"Picante.",i:"üå∂Ô∏è"}, {t:"Selfie.",i:"üì∏"}, {t:"Perro.",i:"üê∂"}, {t:"Bebida.",i:"ü•§"}, {t:"Gira.",i:"üòµ"}, {t:"Frente.",i:"üñçÔ∏è"}, {t:"Escoba.",i:"üßπ"}, {t:"Imita.",i:"ü§°"}, {t:"Hielo.",i:"üßä"}, {t:"SMS.",i:"üì±"}] },
                christmas: { truth: ["¬øRegalo mal?", "¬øReciclado?", "¬øPastel?", "¬øMirado?", "¬øCocinero?", "¬øSanta?", "¬ø√Årbol?", "¬øPeli?", "¬øOlvidado?", "¬øBebida?", "¬øRecuerdo?", "¬øMu√©rdago?", "¬øDeseo?", "¬øRompope?", "¬øRoto?"], dare: [{t:"Reno.",i:"ü¶å"}, {t:"Canela.",i:"ü•Ñ"}, {t:"Lazo.",i:"üéÄ"}, {t:"HoHoHo.",i:"üéÖ"}, {t:"Cinta.",i:"üéÑ"}, {t:"√ìpera.",i:"üé§"}, {t:"Piernas.",i:"ü™ë"}, {t:"Elfo.",i:"üßù"}, {t:"Barriga.",i:"ü§∞"}, {t:"Copo.",i:"‚ùÑÔ∏è"}, {t:"Beso.",i:"üíã"}, {t:"Galleta.",i:"üç™"}, {t:"Nieve.",i:"‚õÑ"}, {t:"Vela.",i:"üïØÔ∏è"}, {t:"Regalo.",i:"üéÅ"}] }
            }
        };

        // Fallback for extra languages (using English data to prevent crashes)
        const fallback = db.en;
        ['it', 'de', 'ja', 'da'].forEach(lang => db[lang] = fallback);

        // --- STATE & TRACKING ---
        let currentLang = 'en';
        let currentScenario = 'christmas';
        let generatedDeck = { truth: [], dare: [] };
        
        // Track seen questions: { truth: Set(indices), dare: Set(indices) }
        let seenIndices = { truth: new Set(), dare: new Set() };

        function createSnow() {
            const snowContainer = document.getElementById('snow-bg');
            for (let i = 0; i < 40; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.innerHTML = '‚ùÑ';
                snowflake.style.left = Math.random() * 100 + 'vw';
                snowflake.style.fontSize = (Math.random() * 15 + 10) + 'px';
                snowflake.style.animationDuration = (Math.random() * 3 + 2) + 's';
                snowflake.style.opacity = Math.random();
                snowContainer.appendChild(snowflake);
            }
        }

        function triggerSnowBurst(x, y) {
            for (let i = 0; i < 30; i++) {
                const flake = document.createElement('div');
                flake.className = 'burst-flake';
                flake.style.left = x + 'px';
                flake.style.top = y + 'px';
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 150 + 50;
                flake.style.setProperty('--tx', Math.cos(angle) * velocity + 'px');
                flake.style.setProperty('--ty', Math.sin(angle) * velocity + 'px');
                flake.style.width = (Math.random() * 8 + 4) + 'px';
                flake.style.height = flake.style.width;
                document.body.appendChild(flake);
                setTimeout(() => flake.remove(), 1000);
            }
        }

        function resetTracker() {
            seenIndices = { truth: new Set(), dare: new Set() };
            // Optional: visual cue that deck reset
        }

        function setLang(lang) {
            currentLang = lang;
            resetTracker(); // Reset questions when changing language
            updateUIText();
        }

        function toggleExtraLangs() {
            const extraDiv = document.getElementById('extra-languages');
            const btn = document.querySelector('.toggle-btn');
            if (extraDiv.style.display === 'flex') {
                extraDiv.style.display = 'none'; btn.innerText = "+ More / Plus";
            } else {
                extraDiv.style.display = 'flex'; btn.innerText = "- Less";
            }
        }

        function setScenario(scen) {
            currentScenario = scen;
            resetTracker(); // Reset questions when changing scenario
            const inputContainer = document.getElementById('personalize-container');
            inputContainer.style.display = (scen === 'personalize') ? 'block' : 'none';
        }

        function generatePersonalizedDeck() {
            const input = document.getElementById('personalize-prompt').value.toLowerCase();
            const status = document.getElementById('gen-status');
            
            if(!input) {
                status.innerText = "Please type a theme first!";
                status.style.color = "#e74c3c";
                return;
            }
            status.innerText = "Generating...";
            status.style.color = "gold";
            setTimeout(() => {
                let mixTruth = [];
                let mixDare = [];
                // Use English source for keyword matching logic logic, or current lang if robust
                // For simplicity in this demo, we pull from current lang if available, else EN
                const src = db[currentLang] || db.en; 

                // Simple keyword mixer
                if(input.includes("student") || input.includes("school") || input.includes("class")) {
                    mixTruth.push(...src.campus.truth); mixDare.push(...src.campus.dare);
                }
                if(input.includes("party") || input.includes("drink")) {
                    mixTruth.push(...src.friends.truth); mixDare.push(...src.friends.dare);
                }
                if(input.includes("family")) {
                    mixTruth.push(...src.family.truth); mixDare.push(...src.family.dare);
                }
                if(input.includes("xmas") || input.includes("christmas")) {
                    mixTruth.push(...src.christmas.truth); mixDare.push(...src.christmas.dare);
                }
                // Fallback
                if(mixTruth.length === 0) {
                    mixTruth.push(...src.friends.truth, ...src.campus.truth);
                    mixDare.push(...src.friends.dare, ...src.campus.dare);
                }

                generatedDeck = { truth: mixTruth, dare: mixDare };
                resetTracker(); // Reset for new deck
                status.innerText = "Deck Ready!";
                status.style.color = "#2ecc71";
            }, 500);
        }

        function updateUIText() {
            const uiText = {
                en: { truth: "Truth", dare: "Dare", click: "Click for next question" },
                fr: { truth: "V√©rit√©", dare: "Action", click: "Cliquez pour suivante" },
                zh: { truth: "ÁúüÂøÉËØù", dare: "Â§ßÂÜíÈô©", click: "ÁÇπÂáª‰∏ã‰∏Ä‰∏™" },
                es: { truth: "Verdad", dare: "Reto", click: "Siguiente" },
                it: { truth: "Verit√†", dare: "Obbligo", click: "Clicca" },
                de: { truth: "Wahrheit", dare: "Pflicht", click: "Klicken" },
                ja: { truth: "ÁúüÂÆü", dare: "ÊåëÊà¶", click: "„ÇØ„É™„ÉÉ„ÇØ" },
                da: { truth: "Sandhed", dare: "Konsekvens", click: "Klik" }
            };
            const txt = uiText[currentLang] || uiText.en;
            document.querySelector('.truth-section .card-title').innerText = txt.truth;
            document.querySelector('.dare-section .card-title').innerText = txt.dare;
            document.querySelectorAll('.click-instruction').forEach(el => el.innerText = txt.click);
        }

        function playTurn(cardElement, type) {
            triggerSnowBurst(cardElement.getBoundingClientRect().left + cardElement.offsetWidth/2, cardElement.getBoundingClientRect().top + cardElement.offsetHeight/2);

            const textEl = document.getElementById(type + '-text');
            const visualEl = document.getElementById('dare-visual');
            textEl.classList.remove('fade-in');
            textEl.classList.remove('final-message');
            if(type === 'dare') visualEl.style.display = 'none';

            let itemList = [];
            
            // 1. Determine List Source
            if (currentScenario === 'personalize') {
                itemList = generatedDeck[type];
                if(itemList.length === 0) {
                    textEl.innerText = "Please generate deck first!";
                    textEl.classList.add('fade-in');
                    return;
                }
            } else {
                // Safely get data. Fallback to EN if language key missing in sub-object
                const langData = db[currentLang] || db.en;
                itemList = langData[currentScenario][type];
            }

            // 2. Filter out already seen indices
            // We map the original list to [0, 1, 2...] then filter out those in the Set
            let availableIndices = itemList.map((_, i) => i).filter(i => !seenIndices[type].has(i));

            // 3. Check if empty
            if (availableIndices.length === 0) {
                setTimeout(() => {
                    textEl.innerHTML = "üéÑ Merry Christmas<br>& Happy New Year! üéÜ";
                    textEl.classList.add('final-message');
                }, 50);
                return;
            }

            // 4. Pick Random from Available
            const randomIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
            seenIndices[type].add(randomIndex); // Mark as seen

            const selectedItem = itemList[randomIndex];
            let text = "";
            let icon = "";

            if(type === 'truth') {
                text = selectedItem;
            } else {
                text = selectedItem.t;
                icon = selectedItem.i;
            }

            setTimeout(() => {
                textEl.innerText = text;
                textEl.classList.add('fade-in');
                if (type === 'dare' && icon) {
                    visualEl.innerText = icon;
                    visualEl.style.display = 'block';
                    visualEl.style.animation = 'none';
                    visualEl.offsetHeight; 
                    visualEl.style.animation = 'popIn 0.5s';
                }
            }, 50);
        }

        createSnow();
        updateUIText();
    </script>
</body>
</html>
